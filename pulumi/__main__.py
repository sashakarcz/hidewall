import pulumi
import pulumi_linode as linode

ord_swarm_1 = linode.Instance("ord-swarm-1",
    alerts=linode.InstanceAlertsArgs(
        cpu=90,
        io=10000,
        network_in=10,
        network_out=10,
        transfer_quota=80,
    ),
    boot_config_label="My Debian 12 Disk Profile",
    booted=True,
    configs=[linode.InstanceConfigArgs(
        comments="",
        devices=linode.InstanceConfigDevicesArgs(
            sda=linode.InstanceConfigDevicesSdaArgs(
                disk_label="Debian 12 Disk",
                volume_id=0,
            ),
            sdb=linode.InstanceConfigDevicesSdbArgs(
                disk_label="512 MB Swap Image",
                volume_id=0,
            ),
        ),
        helpers=linode.InstanceConfigHelpersArgs(
            devtmpfs_automount=True,
            distro=True,
            modules_dep=True,
            network=True,
            updatedb_disabled=True,
        ),
        interfaces=[
            linode.InstanceConfigInterfaceArgs(
                ip_ranges=[],
                ipam_address="",
                ipv4=linode.InstanceConfigInterfaceIpv4Args(
                    nat11="172.232.24.146",
                    vpc="10.69.0.2",
                ),
                label="",
                primary=True,
                purpose="vpc",
            ),
            linode.InstanceConfigInterfaceArgs(
                ip_ranges=[],
                ipam_address="",
                label="",
                primary=False,
                purpose="public",
            ),
        ],
        kernel="linode/grub2",
        label="My Debian 12 Disk Profile",
        memory_limit=0,
        root_device="/dev/sda",
        run_level="default",
        virt_mode="paravirt",
    )],
    disks=[
        linode.InstanceDiskArgs(
            authorized_keys=[],
            authorized_users=[],
            filesystem="ext4",
            image="",
            label="Debian 12 Disk",
            read_only=False,
            root_pass="foobar123456789",
            size=25088,

        ),
        linode.InstanceDiskArgs(
            authorized_keys=[],
            authorized_users=[],
            filesystem="swap",
            image="",
            label="512 MB Swap Image",
            read_only=False,
            root_pass="foobar123456789",
            size=512,
        ),
    ],
    label="ord-swarm-1",
    private_ip=True,
    region="us-ord",
    tags=["swarm"],
    type="g6-nanode-1",
    opts=pulumi.ResourceOptions(protect=True))

ord_swarm_2 = linode.Instance("ord-swarm-2",
    alerts=linode.InstanceAlertsArgs(
        cpu=90,
        io=10000,
        network_in=10,
        network_out=10,
        transfer_quota=80,
    ),
    boot_config_label="My Debian 12 Disk Profile",
    booted=True,
    configs=[linode.InstanceConfigArgs(
        comments="",
        devices=linode.InstanceConfigDevicesArgs(
            sda=linode.InstanceConfigDevicesSdaArgs(
                disk_label="Debian 12 Disk",
                volume_id=0,
            ),
            sdb=linode.InstanceConfigDevicesSdbArgs(
                disk_label="512 MB Swap Image",
                volume_id=0,
            ),
        ),
        helpers=linode.InstanceConfigHelpersArgs(
            devtmpfs_automount=True,
            distro=True,
            modules_dep=True,
            network=True,
            updatedb_disabled=True,
        ),
        interfaces=[
            linode.InstanceConfigInterfaceArgs(
                ip_ranges=[],
                ipam_address="",
                ipv4=linode.InstanceConfigInterfaceIpv4Args(
                    nat11="172.232.30.191",
                    vpc="10.69.0.3",
                ),
                label="",
                primary=True,
                purpose="vpc",
            ),
            linode.InstanceConfigInterfaceArgs(
                ip_ranges=[],
                ipam_address="",
                label="",
                primary=False,
                purpose="public",
            ),
        ],
        kernel="linode/grub2",
        label="My Debian 12 Disk Profile",
        memory_limit=0,
        root_device="/dev/sda",
        run_level="default",
        virt_mode="paravirt",
    )],
    disks=[
        linode.InstanceDiskArgs(
            authorized_keys=[],
            authorized_users=[],
            filesystem="ext4",
            image="",
            label="Debian 12 Disk",
            read_only=False,
            root_pass="foobar123456789",
            size=25088,
        ),
        linode.InstanceDiskArgs(
            authorized_keys=[],
            authorized_users=[],
            filesystem="swap",
            image="",
            label="512 MB Swap Image",
            read_only=False,
            root_pass="foobar123456789",
            size=512,
        ),
    ],
    label="ord-swarm-2",
    private_ip=True,
    region="us-ord",
    tags=["swarm"],
    type="g6-nanode-1",
    opts=pulumi.ResourceOptions(protect=True))
ord_swarm_3 = linode.Instance("ord-swarm-3",
    alerts=linode.InstanceAlertsArgs(
        cpu=90,
        io=10000,
        network_in=10,
        network_out=10,
        transfer_quota=80,
    ),
    boot_config_label="My Debian 12 Disk Profile",
    booted=True,
    configs=[linode.InstanceConfigArgs(
        comments="",
        devices=linode.InstanceConfigDevicesArgs(
            sda=linode.InstanceConfigDevicesSdaArgs(
                disk_label="Debian 12 Disk",
                volume_id=0,
            ),
            sdb=linode.InstanceConfigDevicesSdbArgs(
                disk_label="512 MB Swap Image",
                volume_id=0,
            ),
        ),
        helpers=linode.InstanceConfigHelpersArgs(
            devtmpfs_automount=True,
            distro=True,
            modules_dep=True,
            network=True,
            updatedb_disabled=True,
        ),
        interfaces=[
            linode.InstanceConfigInterfaceArgs(
                ip_ranges=[],
                ipam_address="",
                ipv4=linode.InstanceConfigInterfaceIpv4Args(
                    nat11="172.232.30.216",
                    vpc="10.69.0.4",
                ),
                label="",
                primary=True,
                purpose="vpc",
            ),
            linode.InstanceConfigInterfaceArgs(
                ip_ranges=[],
                ipam_address="",
                label="",
                primary=False,
                purpose="public",
            ),
        ],
        kernel="linode/grub2",
        label="My Debian 12 Disk Profile",
        memory_limit=0,
        root_device="/dev/sda",
        run_level="default",
        virt_mode="paravirt",
    )],
    disks=[
        linode.InstanceDiskArgs(
            authorized_keys=[],
            authorized_users=[],
            filesystem="ext4",
            image="",
            label="Debian 12 Disk",
            read_only=False,
            root_pass="foobar123456789",
            size=25088,
        ),
        linode.InstanceDiskArgs(
            authorized_keys=[],
            authorized_users=[],
            filesystem="swap",
            image="",
            label="512 MB Swap Image",
            read_only=False,
            root_pass="foobar123456789",
            size=512,
        ),
    ],
    label="ord-swarm-3",
    private_ip=True,
    region="us-ord",
    tags=["swarm"],
    type="g6-nanode-1",
    opts=pulumi.ResourceOptions(protect=True))

lb_hidewall = linode.NodeBalancer("lb-hidewall",
    label="lb-hidewall",
    region="us-ord",
    tags=["swarm"],
    opts=pulumi.ResourceOptions(protect=True))

ingress = linode.Firewall("ingress",
    inbound_policy="DROP",
    inbounds=[
        linode.FirewallInboundArgs(
            action="DROP",
            ipv4s=["0.0.0.0/0"],
            ipv6s=["::/0"],
            label="drop-inbound-SSH",
            ports="22",
            protocol="TCP",
        ),
        linode.FirewallInboundArgs(
            action="ACCEPT",
            ipv4s=["10.69.0.0/24"],
            ipv6s=[],
            label="local-docker-swarm",
            ports="2377",
            protocol="TCP",
        ),
        linode.FirewallInboundArgs(
            action="ACCEPT",
            ipv4s=[
                "192.168.255.0/24",
                "10.69.0.0/24",
                "192.168.128.0/17",
            ],
            ipv6s=[],
            label="accept-inbound-tcp",
            ports="1-65535",
            protocol="TCP",
        ),
        linode.FirewallInboundArgs(
            action="ACCEPT",
            ipv4s=[
                "192.168.255.0/24",
                "10.69.0.0/24",
                "192.168.128.0/17",
            ],
            ipv6s=[],
            label="accept-inbound-udp",
            ports="1-65535",
            protocol="UDP",
        ),
        linode.FirewallInboundArgs(
            action="ACCEPT",
            ipv4s=[
                "192.168.255.0/24",
                "10.69.0.0/24",
                "192.168.128.0/17",
            ],
            ipv6s=[],
            label="accept-inbound-icmp",
            ports="",
            protocol="ICMP",
        ),
        linode.FirewallInboundArgs(
            action="ACCEPT",
            ipv4s=[
                "192.168.255.0/24",
                "10.69.0.0/24",
                "192.168.128.0/17",
            ],
            ipv6s=[],
            label="accept-inbound-ipencap",
            ports="",
            protocol="IPENCAP",
        ),
        linode.FirewallInboundArgs(
            action="ACCEPT",
            ipv4s=["198.41.192.77/32"],
            ipv6s=[],
            label="accept-cf-tunnel",
            ports="1-65535",
            protocol="TCP",
        ),
    ],
    label="ingress",
    linodes=[
        56058248,
        56058193,
        56058243,
    ],
    outbound_policy="ACCEPT",
    opts=pulumi.ResourceOptions(protect=True))

cloudflare_ips = linode.Firewall("cloudflare_ips",
    inbound_policy="DROP",
    inbounds=[linode.FirewallInboundArgs(
        action="ACCEPT",
        ipv4s=[
            "173.245.48.0/20",
            "103.21.244.0/22",
            "103.22.200.0/22",
            "103.31.4.0/22",
            "141.101.64.0/18",
            "108.162.192.0/18",
            "190.93.240.0/20",
            "188.114.96.0/20",
            "197.234.240.0/22",
            "198.41.128.0/17",
            "162.158.0.0/15",
            "104.16.0.0/13",
            "104.24.0.0/14",
            "172.64.0.0/13",
            "131.0.72.0/22",
        ],
        ipv6s=[
            "2400:cb00::/32",
            "2606:4700::/32",
            "2803:f800::/32",
            "2405:b500::/32",
            "2405:8100::/32",
            "2a06:98c0::/29",
            "2c0f:f248::/32",
        ],
        label="accept-inbound-HTTPS",
        ports="443",
        protocol="TCP",
    )],
    label="cloudflare_ips",
    nodebalancers=[557549],
    outbound_policy="ACCEPT",
    opts=pulumi.ResourceOptions(protect=True))

